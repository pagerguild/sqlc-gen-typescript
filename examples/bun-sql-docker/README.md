# bun-sql-docker

A complete, self-contained example demonstrating native Bun SQL with PostgreSQL using Docker.

This example:
- Starts a PostgreSQL container using Docker
- Creates a test database and schema
- Runs a Bun test program that exercises all CRUD operations
- Validates the sqlc-generated TypeScript code works correctly
- Cleans up the container when done

## Prerequisites

- [Bun](https://bun.sh) (v1.2 or later for native SQL support)
- [Docker](https://www.docker.com/)

## Quick Start

Run the complete test:

```bash
./run-test.sh
```

This script will:
1. Start a PostgreSQL container
2. Wait for it to be ready
3. Create the database schema
4. Run the test program
5. Clean up the container

## Manual Steps

If you want to run things manually:

### 1. Start PostgreSQL

```bash
docker run -d \
  --name sqlc-bun-test-db \
  -e POSTGRES_USER=testuser \
  -e POSTGRES_PASSWORD=testpass \
  -e POSTGRES_DB=testdb \
  -p 5433:5432 \
  postgres:alpine
```

### 2. Wait for PostgreSQL to be ready

```bash
until docker exec sqlc-bun-test-db pg_isready -U testuser; do
  sleep 1
done
```

### 3. Create the schema

```bash
docker exec -i sqlc-bun-test-db psql -U testuser -d testdb < ../authors/postgresql/schema.sql
```

### 4. Run the test

```bash
DATABASE_URL="postgres://testuser:testpass@localhost:5433/testdb" bun run src/main.ts
```

### 5. Clean up

```bash
docker rm -f sqlc-bun-test-db
```

## What This Example Demonstrates

- **Zero npm dependencies** for PostgreSQL - uses Bun's built-in SQL support
- **Type-safe database queries** generated by sqlc
- **Full CRUD operations**: Create, Read, Update, Delete
- **Docker-based testing** for reproducible environments

## Generated Code

The `src/db/query_sql.ts` file is generated by sqlc using the `bun-sql` driver. 
It provides type-safe functions for:

- `createAuthor(sql, { name, bio })` - Insert a new author
- `getAuthor(sql, { id })` - Get an author by ID
- `listAuthors(sql)` - List all authors
- `deleteAuthor(sql, { id })` - Delete an author

## Configuration

This example uses the following sqlc configuration:

```yaml
- schema: "authors/postgresql/schema.sql"
  queries: "authors/postgresql/query.sql"
  engine: "postgresql"
  codegen:
  - plugin: ts
    out: bun-sql-docker/src/db
    options:
      runtime: bun
      driver: bun-sql
```
